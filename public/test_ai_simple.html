<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIåŠ©æ•™æ¸¬è©¦</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css" rel="stylesheet">
    <style>
        .CodeMirror {
            height: 200px;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h2>ğŸ¤– AIåŠ©æ•™æ¸¬è©¦</h2>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Python ä»£ç¢¼ç·¨è¼¯å™¨</h5>
                    </div>
                    <div class="card-body">
                        <textarea id="codeEditor">print("Hello, World!")
x = 5
y = 3
print(f"{x} + {y} = {x + y}")</textarea>
                        <div class="mt-3">
                            <button class="btn btn-primary" onclick="testAI()">
                                <i class="fas fa-brain"></i> æ¸¬è©¦AIåˆ†æ
                            </button>
                            <button class="btn btn-info" onclick="testCodeGetter()">
                                <i class="fas fa-code"></i> æ¸¬è©¦ä»£ç¢¼ç²å–
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>AIå›æ‡‰å€åŸŸ</h5>
                    </div>
                    <div class="card-body">
                        <div id="aiResponse" style="min-height: 200px;">
                            <div class="text-center text-muted p-4">
                                <i class="fas fa-robot fa-3x mb-3"></i>
                                <h6>ğŸ¤– AIåŠ©æ•™å·²æº–å‚™å°±ç·’</h6>
                                <p class="mb-0">é»æ“ŠæŒ‰éˆ•é–‹å§‹æ¸¬è©¦</p>
                            </div>
                        </div>
                        <div id="aiShareOptions" style="display: none;"></div>
                    </div>
                </div>
                
                <div class="card mt-3">
                    <div class="card-header">
                        <h6>èª¿è©¦æ—¥èªŒ</h6>
                    </div>
                    <div class="card-body">
                        <div id="debugLog" style="height: 150px; overflow-y: auto; font-family: monospace; font-size: 12px; background: #f8f9fa; padding: 10px; border-radius: 4px;">
                            <div class="text-muted">ç­‰å¾…æ“ä½œ...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- å¿…è¦çš„åº« -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.min.js"></script>

    <!-- æ¨¡æ“¬ç’°å¢ƒ -->
    <script>
        // æ¨¡æ“¬å¿…è¦çš„å…¨å±€å°è±¡
        window.wsManager = {
            isConnected: () => true,
            currentRoom: 'test-room'
        };
        
        window.AutoLogin = {
            getCurrentUser: () => ({ id: 1, username: 'TestUser' })
        };
    </script>

    <!-- è¼‰å…¥æ‡‰ç”¨è…³æœ¬ -->
    <script src="js/editor.js"></script>
    <script src="js/ai-assistant.js"></script>

    <script>
        let editor;
        let aiAssistant;
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸš€ é é¢è¼‰å…¥å®Œæˆ');
            
            setTimeout(() => {
                initializeComponents();
            }, 1000);
        });
        
        function initializeComponents() {
            log('ğŸ”§ åˆå§‹åŒ–çµ„ä»¶...');
            
            // åˆå§‹åŒ–CodeMirrorç·¨è¼¯å™¨
            const textarea = document.getElementById('codeEditor');
            if (textarea && typeof CodeMirror !== 'undefined') {
                editor = CodeMirror.fromTextArea(textarea, {
                    mode: 'python',
                    lineNumbers: true,
                    theme: 'default'
                });
                
                // è¨­ç½®å…¨å±€ç·¨è¼¯å™¨å°è±¡
                window.Editor = {
                    editor: editor,
                    getCode: () => editor.getValue(),
                    setCode: (code) => editor.setValue(code)
                };
                
                log('âœ… ç·¨è¼¯å™¨åˆå§‹åŒ–å®Œæˆ');
            } else {
                log('âŒ ç·¨è¼¯å™¨åˆå§‹åŒ–å¤±æ•—');
            }
            
            // åˆå§‹åŒ–AIåŠ©æ•™
            if (window.AIAssistantManager) {
                aiAssistant = new AIAssistantManager();
                aiAssistant.initialize();
                window.aiAssistant = aiAssistant;
                log('âœ… AIåŠ©æ•™åˆå§‹åŒ–å®Œæˆ');
            } else {
                log('âŒ AIåŠ©æ•™é¡æœªæ‰¾åˆ°');
            }
        }
        
        function testCodeGetter() {
            log('ğŸ” æ¸¬è©¦ä»£ç¢¼ç²å–...');
            
            if (!aiAssistant) {
                log('âŒ AIåŠ©æ•™æœªåˆå§‹åŒ–');
                return;
            }
            
            try {
                const code = aiAssistant.getEditorCode();
                log(`âœ… ä»£ç¢¼ç²å–æˆåŠŸ: ${code.length} å­—ç¬¦`);
                log(`ğŸ“ ä»£ç¢¼å…§å®¹: ${code.substring(0, 50)}...`);
                
                document.getElementById('aiResponse').innerHTML = `
                    <div class="alert alert-success">
                        <h6><i class="fas fa-check-circle"></i> ä»£ç¢¼ç²å–æ¸¬è©¦æˆåŠŸ</h6>
                        <p><strong>é•·åº¦:</strong> ${code.length} å­—ç¬¦</p>
                        <p><strong>å…§å®¹:</strong></p>
                        <pre style="background: #f8f9fa; padding: 10px; border-radius: 4px;">${code}</pre>
                    </div>
                `;
            } catch (error) {
                log(`âŒ ä»£ç¢¼ç²å–å¤±æ•—: ${error.message}`);
                document.getElementById('aiResponse').innerHTML = `
                    <div class="alert alert-danger">
                        <h6><i class="fas fa-exclamation-circle"></i> ä»£ç¢¼ç²å–å¤±æ•—</h6>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
        
        async function testAI() {
            log('ğŸ¤– æ¸¬è©¦AIåˆ†æ...');
            
            if (!aiAssistant) {
                log('âŒ AIåŠ©æ•™æœªåˆå§‹åŒ–');
                return;
            }
            
            try {
                // ç›´æ¥èª¿ç”¨AIåˆ†æ
                aiAssistant.requestAnalysis('analyze');
                log('âœ… AIåˆ†æè«‹æ±‚å·²ç™¼é€');
            } catch (error) {
                log(`âŒ AIåˆ†æå¤±æ•—: ${error.message}`);
            }
        }
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logContainer = document.getElementById('debugLog');
            
            const div = document.createElement('div');
            div.innerHTML = `[${timestamp}] ${message}`;
            
            logContainer.appendChild(div);
            logContainer.scrollTop = logContainer.scrollHeight;
            
            console.log(`[AIæ¸¬è©¦] ${message}`);
        }
    </script>
</body>
</html> 