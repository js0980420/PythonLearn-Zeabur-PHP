<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIåŠ©æ•™å¢å¼·æ¸¬è©¦</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/default.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
        }
        .card {
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .status-good { color: #28a745; }
        .status-warning { color: #ffc107; }
        .status-error { color: #dc3545; }
        .CodeMirror {
            height: 300px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .monitor-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 300px;
            max-height: 80vh;
            overflow-y: auto;
            z-index: 1000;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            padding: 15px;
        }
        .log-entry {
            font-size: 12px;
            margin: 2px 0;
            padding: 2px 6px;
            border-radius: 3px;
        }
        .log-success { background: #d4edda; color: #155724; }
        .log-warning { background: #fff3cd; color: #856404; }
        .log-error { background: #f8d7da; color: #721c24; }
        .log-info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="text-center mb-4">ğŸ¤– AIåŠ©æ•™å¢å¼·æ¸¬è©¦</h1>
        
        <div class="row">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-code"></i> Python ä»£ç¢¼ç·¨è¼¯å™¨</h5>
                    </div>
                    <div class="card-body">
                        <textarea id="codeEditor" name="code"># æ­¡è¿ä½¿ç”¨Pythonå­¸ç¿’å¹³å°
# åœ¨æ­¤è¼¸å…¥æ‚¨çš„Pythonä»£ç¢¼

print("Hello, World!")

# ç¯„ä¾‹ï¼šè¨ˆç®—å…©å€‹æ•¸å­—çš„å’Œ
def add_numbers(a, b):
    return a + b

result = add_numbers(5, 3)
print(f"5 + 3 = {result}")
</textarea>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-robot"></i> AIåŠ©æ•™æ¸¬è©¦</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <button class="btn btn-primary w-100 mb-2" onclick="testCodeRetrieval()">
                                    <i class="fas fa-search"></i> æ¸¬è©¦ä»£ç¢¼ç²å–
                                </button>
                                <button class="btn btn-success w-100 mb-2" onclick="testAIAnalysis()">
                                    <i class="fas fa-brain"></i> æ¸¬è©¦AIåˆ†æ
                                </button>
                                <button class="btn btn-warning w-100 mb-2" onclick="simulateAI('analyze')">
                                    <i class="fas fa-microscope"></i> è§£é‡‹ç¨‹å¼ç¢¼
                                </button>
                            </div>
                            <div class="col-md-6">
                                <button class="btn btn-info w-100 mb-2" onclick="simulateAI('check_errors')">
                                    <i class="fas fa-bug"></i> æª¢æŸ¥éŒ¯èª¤
                                </button>
                                <button class="btn btn-secondary w-100 mb-2" onclick="simulateAI('suggest')">
                                    <i class="fas fa-lightbulb"></i> æ”¹é€²å»ºè­°
                                </button>
                                <button class="btn btn-danger w-100 mb-2" onclick="clearAll()">
                                    <i class="fas fa-trash"></i> æ¸…ç©ºæ‰€æœ‰
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-chart-line"></i> ç³»çµ±ç‹€æ…‹</h5>
                    </div>
                    <div class="card-body" id="systemStatus">
                        <div class="status-info">æ­£åœ¨æª¢æŸ¥...</div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5><i class="fas fa-robot"></i> AIåŠ©æ•™å›æ‡‰</h5>
                        <button class="btn btn-sm btn-outline-secondary" onclick="togglePanel()">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="aiResponse" style="min-height: 200px;">
                            <div class="text-center text-muted p-4">
                                <i class="fas fa-robot fa-3x mb-3"></i>
                                <h6>ğŸ¤– AIåŠ©æ•™å·²æº–å‚™å°±ç·’</h6>
                                <p class="mb-0">é»æ“Šå·¦å´æŒ‰éˆ•é–‹å§‹æ¸¬è©¦</p>
                            </div>
                        </div>
                        <div id="aiShareOptions" style="display: none;">
                            <!-- AIåˆ†äº«é¸é … -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ç›£æ§é¢æ¿ -->
    <div class="monitor-panel" id="monitorPanel">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <h6><i class="fas fa-monitor"></i> å¯¦æ™‚ç›£æ§</h6>
            <button class="btn btn-sm btn-close" onclick="togglePanel()"></button>
        </div>
        <div id="monitorLogs" style="max-height: 300px; overflow-y: auto;">
            <div class="log-entry log-info">ç›£æ§ç³»çµ±å•Ÿå‹•ä¸­...</div>
        </div>
        <div class="mt-2">
            <button class="btn btn-sm btn-outline-primary w-100" onclick="clearMonitorLogs()">
                <i class="fas fa-broom"></i> æ¸…ç©ºæ—¥èªŒ
            </button>
        </div>
    </div>

    <!-- è¼‰å…¥å¿…è¦çš„åº« -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.min.js"></script>

    <!-- æ¨¡æ“¬å¿…è¦çš„å…¨å±€å°è±¡ -->
    <script>
        // æ¨¡æ“¬ wsManager
        window.wsManager = {
            isConnected: () => true,
            currentRoom: 'test-room'
        };
        
        // æ¨¡æ“¬ AutoLogin
        window.AutoLogin = {
            getCurrentUser: () => ({ id: 1, username: 'TestUser' })
        };
    </script>

    <!-- è¼‰å…¥æ‡‰ç”¨è…³æœ¬ -->
    <script src="js/editor.js"></script>
    <script src="js/ai-assistant.js"></script>

    <script>
        let monitorInterval;
        let monitorVisible = true;
        
        // åˆå§‹åŒ–é é¢
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸš€ é é¢è¼‰å…¥å®Œæˆï¼Œé–‹å§‹åˆå§‹åŒ–...', 'info');
            
            // ç­‰å¾…ä¸€é»æ™‚é–“è®“è…³æœ¬è¼‰å…¥
            setTimeout(() => {
                initializeComponents();
                startMonitoring();
            }, 1000);
        });
        
        function initializeComponents() {
            log('ğŸ”§ åˆå§‹åŒ–çµ„ä»¶...', 'info');
            
            // åˆå§‹åŒ–AIåŠ©æ•™
            if (window.AIAssistantManager) {
                window.aiAssistant = new AIAssistantManager();
                window.aiAssistant.initialize();
                log('âœ… AIåŠ©æ•™å·²åˆå§‹åŒ–', 'success');
            } else {
                log('âŒ AIåŠ©æ•™é¡æœªæ‰¾åˆ°', 'error');
            }
            
            // æª¢æŸ¥ç·¨è¼¯å™¨
            if (window.Editor) {
                log('âœ… ç·¨è¼¯å™¨ç®¡ç†å™¨å·²è¼‰å…¥', 'success');
            } else {
                log('âŒ ç·¨è¼¯å™¨ç®¡ç†å™¨æœªè¼‰å…¥', 'error');
            }
            
            updateSystemStatus();
        }
        
        function updateSystemStatus() {
            const status = {
                'CodeMirror': typeof CodeMirror !== 'undefined',
                'window.Editor': !!window.Editor,
                'window.Editor.getCode': !!(window.Editor && window.Editor.getCode),
                'window.aiAssistant': !!window.aiAssistant,
                'AIåŠ©æ•™å°±ç·’': !!(window.aiAssistant && window.aiAssistant.editorReady),
                'wsManager': !!window.wsManager,
                'AutoLogin': !!window.AutoLogin
            };
            
            let html = '';
            for (const [key, value] of Object.entries(status)) {
                const statusClass = value ? 'status-good' : 'status-error';
                const icon = value ? 'âœ…' : 'âŒ';
                html += `<div class="${statusClass}">${icon} ${key}</div>`;
            }
            
            document.getElementById('systemStatus').innerHTML = html;
        }
        
        function testCodeRetrieval() {
            log('ğŸ” é–‹å§‹æ¸¬è©¦ä»£ç¢¼ç²å–...', 'info');
            
            if (!window.aiAssistant) {
                log('âŒ AIåŠ©æ•™æœªåˆå§‹åŒ–', 'error');
                return;
            }
            
            try {
                const code = window.aiAssistant.getEditorCode();
                if (code && code.trim().length > 0) {
                    log(`âœ… ä»£ç¢¼ç²å–æˆåŠŸ: ${code.length} å­—ç¬¦`, 'success');
                    log(`ğŸ“ ä»£ç¢¼é è¦½: ${code.substring(0, 50)}...`, 'info');
                    
                    // é¡¯ç¤ºåœ¨AIå›æ‡‰å€åŸŸ
                    document.getElementById('aiResponse').innerHTML = `
                        <div class="alert alert-success">
                            <h6><i class="fas fa-check-circle"></i> ä»£ç¢¼ç²å–æˆåŠŸ</h6>
                            <p><strong>é•·åº¦:</strong> ${code.length} å­—ç¬¦</p>
                            <p><strong>é è¦½:</strong></p>
                            <pre style="max-height: 200px; overflow-y: auto;">${code}</pre>
                        </div>
                    `;
                } else {
                    log('âŒ æœªç²å–åˆ°ä»£ç¢¼', 'error');
                    document.getElementById('aiResponse').innerHTML = `
                        <div class="alert alert-danger">
                            <h6><i class="fas fa-exclamation-circle"></i> ä»£ç¢¼ç²å–å¤±æ•—</h6>
                            <p>ç„¡æ³•å¾ç·¨è¼¯å™¨ç²å–ä»£ç¢¼å…§å®¹</p>
                        </div>
                    `;
                }
            } catch (error) {
                log(`âŒ ä»£ç¢¼ç²å–ç•°å¸¸: ${error.message}`, 'error');
                document.getElementById('aiResponse').innerHTML = `
                    <div class="alert alert-danger">
                        <h6><i class="fas fa-exclamation-circle"></i> ä»£ç¢¼ç²å–ç•°å¸¸</h6>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
        
        async function testAIAnalysis() {
            log('ğŸ¤– é–‹å§‹æ¸¬è©¦AIåˆ†æ...', 'info');
            
            if (!window.aiAssistant) {
                log('âŒ AIåŠ©æ•™æœªåˆå§‹åŒ–', 'error');
                return;
            }
            
            try {
                const code = window.aiAssistant.getEditorCode();
                if (!code || code.trim() === '') {
                    log('âš ï¸ ç·¨è¼¯å™¨ä¸­æ²’æœ‰ä»£ç¢¼', 'warning');
                    return;
                }
                
                log('ğŸ“¡ ç™¼é€AIè«‹æ±‚...', 'info');
                
                const response = await fetch('/api/ai.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        action: 'analyze',
                        code: code,
                        requestId: `test_${Date.now()}`,
                        user_id: 1,
                        username: 'TestUser'
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    log('âœ… AIåˆ†ææˆåŠŸ', 'success');
                    
                    document.getElementById('aiResponse').innerHTML = `
                        <div class="alert alert-success">
                            <h6><i class="fas fa-robot"></i> AIåˆ†æçµæœ</h6>
                            <p><strong>æ¨¡å¼:</strong> ${result.mode}</p>
                            <p><strong>ç‹€æ…‹:</strong> ${result.success ? 'æˆåŠŸ' : 'å¤±æ•—'}</p>
                            <div style="max-height: 300px; overflow-y: auto;">
                                ${result.response || 'ç„¡å›æ‡‰å…§å®¹'}
                            </div>
                        </div>
                    `;
                } else {
                    const errorText = await response.text();
                    log(`âŒ AIè«‹æ±‚å¤±æ•—: HTTP ${response.status}`, 'error');
                    
                    document.getElementById('aiResponse').innerHTML = `
                        <div class="alert alert-danger">
                            <h6><i class="fas fa-exclamation-circle"></i> AIè«‹æ±‚å¤±æ•—</h6>
                            <p>HTTP ${response.status}</p>
                            <pre>${errorText}</pre>
                        </div>
                    `;
                }
                
            } catch (error) {
                log(`âŒ AIåˆ†æç•°å¸¸: ${error.message}`, 'error');
                document.getElementById('aiResponse').innerHTML = `
                    <div class="alert alert-danger">
                        <h6><i class="fas fa-exclamation-circle"></i> AIåˆ†æç•°å¸¸</h6>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
        
        function simulateAI(action) {
            log(`ğŸ¯ æ¨¡æ“¬AIå‹•ä½œ: ${action}`, 'info');
            
            if (window.aiAssistant && typeof window.aiAssistant.requestAnalysis === 'function') {
                window.aiAssistant.requestAnalysis(action);
                log('âœ… AIå‹•ä½œå·²è§¸ç™¼', 'success');
            } else {
                log('âŒ AIåŠ©æ•™ä¸å¯ç”¨', 'error');
            }
        }
        
        function clearAll() {
            document.getElementById('aiResponse').innerHTML = `
                <div class="text-center text-muted p-4">
                    <i class="fas fa-robot fa-3x mb-3"></i>
                    <h6>ğŸ¤– AIåŠ©æ•™å·²æº–å‚™å°±ç·’</h6>
                    <p class="mb-0">é»æ“ŠæŒ‰éˆ•é–‹å§‹æ¸¬è©¦</p>
                </div>
            `;
            clearMonitorLogs();
            log('ğŸ§¹ å·²æ¸…ç©ºæ‰€æœ‰å…§å®¹', 'info');
        }
        
        function startMonitoring() {
            monitorInterval = setInterval(() => {
                updateSystemStatus();
            }, 2000);
            
            log('ğŸ”„ å¯¦æ™‚ç›£æ§å·²å•Ÿå‹•', 'success');
        }
        
        function togglePanel() {
            const panel = document.getElementById('monitorPanel');
            monitorVisible = !monitorVisible;
            panel.style.display = monitorVisible ? 'block' : 'none';
        }
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logContainer = document.getElementById('monitorLogs');
            
            const div = document.createElement('div');
            div.className = `log-entry log-${type}`;
            div.innerHTML = `[${timestamp}] ${message}`;
            
            logContainer.appendChild(div);
            logContainer.scrollTop = logContainer.scrollHeight;
            
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        function clearMonitorLogs() {
            document.getElementById('monitorLogs').innerHTML = '';
            log('æ—¥èªŒå·²æ¸…ç©º', 'info');
        }
    </script>
</body>
</html> 