<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIåŠŸèƒ½èª¿è©¦æ¸¬è©¦</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h2><i class="fas fa-bug"></i> AIåŠŸèƒ½èª¿è©¦æ¸¬è©¦</h2>
        
        <div class="row">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h5>æ¸¬è©¦æ­¥é©Ÿ</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">æ¸¬è©¦ä»£ç¢¼</label>
                            <textarea id="testCode" class="form-control" rows="5">print("Hello, World!")
# é€™æ˜¯ä¸€å€‹æ¸¬è©¦
for i in range(3):
    print(f"æ•¸å­—: {i}")</textarea>
                        </div>
                        
                        <div class="mb-3">
                            <h6>æ¸¬è©¦æ­¥é©Ÿï¼š</h6>
                            <button class="btn btn-primary me-2" onclick="testStep1()">1. æª¢æŸ¥AIåŠ©æ•™å¯¦ä¾‹</button>
                            <button class="btn btn-info me-2" onclick="testStep2()">2. æ¸¬è©¦WebSocketé€£æ¥</button>
                            <button class="btn btn-success me-2" onclick="testStep3()">3. ç™¼é€AIè«‹æ±‚</button>
                            <button class="btn btn-warning" onclick="testStep4()">4. æ¨¡æ“¬AIå›æ‡‰</button>
                        </div>
                        
                        <div class="mb-3">
                            <h6>å¿«é€Ÿæ¸¬è©¦ï¼š</h6>
                            <button class="btn btn-outline-primary me-2" onclick="quickTestAI()">
                                <i class="fas fa-robot"></i> å¿«é€ŸAIæ¸¬è©¦
                            </button>
                            <button class="btn btn-outline-success me-2" onclick="testGlobalFunctions()">
                                <i class="fas fa-cog"></i> æ¸¬è©¦å…¨åŸŸå‡½æ•¸
                            </button>
                            <button class="btn btn-outline-info" onclick="clearLog()">
                                <i class="fas fa-trash"></i> æ¸…é™¤æ—¥èªŒ
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="card mt-3">
                    <div class="card-header">
                        <h5>æ¸¬è©¦æ—¥èªŒ</h5>
                    </div>
                    <div class="card-body">
                        <div id="testLog" style="height: 300px; overflow-y: auto; background: #f8f9fa; padding: 10px; font-family: monospace; font-size: 12px;"></div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <h5>AIå›æ‡‰å€åŸŸ</h5>
                    </div>
                    <div class="card-body">
                        <div id="aiResponse" style="min-height: 200px; border: 1px solid #ddd; padding: 10px; border-radius: 5px;">
                            <div class="text-center text-muted">
                                <i class="fas fa-robot fa-2x mb-2"></i>
                                <p>AIå›æ‡‰å°‡é¡¯ç¤ºåœ¨é€™è£¡</p>
                            </div>
                        </div>
                        
                        <div id="aiShareOptions" style="display: none;" class="mt-3">
                            <button class="btn btn-outline-primary btn-sm">
                                <i class="fas fa-share"></i> åˆ†äº«åˆ°èŠå¤©å®¤
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="card mt-3">
                    <div class="card-header">
                        <h5>ç³»çµ±ç‹€æ…‹</h5>
                    </div>
                    <div class="card-body">
                        <div id="systemStatus">
                            <p><strong>AIåŠ©æ•™å¯¦ä¾‹ï¼š</strong> <span id="aiInstanceStatus" class="badge bg-secondary">æœªæª¢æŸ¥</span></p>
                            <p><strong>WebSocketé€£æ¥ï¼š</strong> <span id="wsStatus" class="badge bg-secondary">æœªæª¢æŸ¥</span></p>
                            <p><strong>DOMå…ƒç´ ï¼š</strong> <span id="domStatus" class="badge bg-secondary">æœªæª¢æŸ¥</span></p>
                            <p><strong>å…¨åŸŸå‡½æ•¸ï¼š</strong> <span id="globalFuncStatus" class="badge bg-secondary">æœªæª¢æŸ¥</span></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- è¼‰å…¥å¿…è¦çš„è…³æœ¬ -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- æ¨¡æ“¬WebSocketç®¡ç†å™¨ -->
    <script>
        // æ¨¡æ“¬WebSocketç®¡ç†å™¨
        window.wsManager = {
            isConnected: function() {
                return true; // æ¨¡æ“¬å·²é€£æ¥
            },
            sendMessage: function(message) {
                log(`ğŸ“¤ æ¨¡æ“¬ç™¼é€WebSocketæ¶ˆæ¯: ${message.type}`, 'info');
                
                // æ¨¡æ“¬AIå›æ‡‰
                if (message.type === 'ai_request') {
                    setTimeout(() => {
                        const mockResponse = {
                            type: 'ai_response',
                            success: true,
                            response: "é€™æ˜¯ä¸€å€‹æ¨¡æ“¬çš„AIå›æ‡‰ã€‚æ‚¨çš„ä»£ç¢¼åŠŸèƒ½æ˜¯è¼¸å‡ºHello Worldå’Œä¸€å€‹ç°¡å–®çš„å¾ªç’°ã€‚",
                            requestId: message.requestId,
                            action: message.action
                        };
                        
                        log(`ğŸ“¥ æ¨¡æ“¬æ”¶åˆ°AIå›æ‡‰`, 'success');
                        
                        // èª¿ç”¨AIåŠ©æ•™è™•ç†å›æ‡‰
                        if (window.AIAssistant && window.AIAssistant.handleWebSocketAIResponse) {
                            window.AIAssistant.handleWebSocketAIResponse(mockResponse);
                        } else {
                            log(`âŒ AIåŠ©æ•™æœªæ‰¾åˆ°æˆ–æ–¹æ³•ä¸å­˜åœ¨`, 'error');
                        }
                    }, 2000); // 2ç§’å¾Œå›æ‡‰
                }
            },
            currentRoom: 'test_room_001'
        };
        
        // æ¨¡æ“¬ç·¨è¼¯å™¨
        window.Editor = {
            getCode: function() {
                return document.getElementById('testCode').value;
            }
        };
    </script>
    
    <!-- è¼‰å…¥AIåŠ©æ•™è…³æœ¬ -->
    <script src="public/js/ai-assistant.js"></script>
    
    <script>
        function log(message, type = 'info') {
            const logDiv = document.getElementById('testLog');
            const timestamp = new Date().toLocaleTimeString();
            const icon = type === 'error' ? 'âŒ' : type === 'success' ? 'âœ…' : type === 'warning' ? 'âš ï¸' : 'â„¹ï¸';
            logDiv.innerHTML += `[${timestamp}] ${icon} ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('testLog').innerHTML = '';
        }

        function updateStatus(elementId, status, type) {
            const element = document.getElementById(elementId);
            element.textContent = status;
            element.className = `badge bg-${type}`;
        }

        // æ¸¬è©¦æ­¥é©Ÿ1ï¼šæª¢æŸ¥AIåŠ©æ•™å¯¦ä¾‹
        function testStep1() {
            log('ğŸ” æ­¥é©Ÿ1ï¼šæª¢æŸ¥AIåŠ©æ•™å¯¦ä¾‹...');
            
            if (window.AIAssistant) {
                log('âœ… window.AIAssistant å­˜åœ¨', 'success');
                updateStatus('aiInstanceStatus', 'æ­£å¸¸', 'success');
                
                // æª¢æŸ¥é—œéµæ–¹æ³•
                const methods = ['initialize', 'requestAnalysis', 'handleWebSocketAIResponse', 'showResponse'];
                methods.forEach(method => {
                    if (typeof window.AIAssistant[method] === 'function') {
                        log(`âœ… æ–¹æ³• ${method} å­˜åœ¨`, 'success');
                    } else {
                        log(`âŒ æ–¹æ³• ${method} ä¸å­˜åœ¨`, 'error');
                    }
                });
            } else {
                log('âŒ window.AIAssistant ä¸å­˜åœ¨', 'error');
                updateStatus('aiInstanceStatus', 'éŒ¯èª¤', 'danger');
            }
        }

        // æ¸¬è©¦æ­¥é©Ÿ2ï¼šæ¸¬è©¦WebSocketé€£æ¥
        function testStep2() {
            log('ğŸ” æ­¥é©Ÿ2ï¼šæª¢æŸ¥WebSocketé€£æ¥...');
            
            if (window.wsManager) {
                log('âœ… wsManager å­˜åœ¨', 'success');
                
                if (window.wsManager.isConnected()) {
                    log('âœ… WebSocket å·²é€£æ¥', 'success');
                    updateStatus('wsStatus', 'å·²é€£æ¥', 'success');
                } else {
                    log('âš ï¸ WebSocket æœªé€£æ¥', 'warning');
                    updateStatus('wsStatus', 'æœªé€£æ¥', 'warning');
                }
            } else {
                log('âŒ wsManager ä¸å­˜åœ¨', 'error');
                updateStatus('wsStatus', 'éŒ¯èª¤', 'danger');
            }
        }

        // æ¸¬è©¦æ­¥é©Ÿ3ï¼šç™¼é€AIè«‹æ±‚
        function testStep3() {
            log('ğŸ” æ­¥é©Ÿ3ï¼šç™¼é€AIè«‹æ±‚...');
            
            if (window.AIAssistant && window.wsManager) {
                try {
                    window.AIAssistant.requestAnalysis('explain_code');
                    log('âœ… AIè«‹æ±‚å·²ç™¼é€', 'success');
                } catch (error) {
                    log(`âŒ ç™¼é€AIè«‹æ±‚å¤±æ•—: ${error.message}`, 'error');
                }
            } else {
                log('âŒ AIåŠ©æ•™æˆ–WebSocketç®¡ç†å™¨ä¸å­˜åœ¨', 'error');
            }
        }

        // æ¸¬è©¦æ­¥é©Ÿ4ï¼šæ¨¡æ“¬AIå›æ‡‰
        function testStep4() {
            log('ğŸ” æ­¥é©Ÿ4ï¼šæ¨¡æ“¬AIå›æ‡‰...');
            
            if (window.AIAssistant) {
                const mockResponse = {
                    success: true,
                    response: "é€™æ˜¯ä¸€å€‹æ¸¬è©¦AIå›æ‡‰ã€‚æ‚¨çš„ä»£ç¢¼åŠŸèƒ½æ˜¯è¼¸å‡ºHello Worldå’Œä¸€å€‹ç°¡å–®çš„å¾ªç’°ã€‚ä»£ç¢¼çµæ§‹æ¸…æ™°ï¼Œé‚è¼¯æ­£ç¢ºã€‚",
                    requestId: 'test_' + Date.now()
                };
                
                try {
                    window.AIAssistant.handleWebSocketAIResponse(mockResponse);
                    log('âœ… æ¨¡æ“¬AIå›æ‡‰è™•ç†å®Œæˆ', 'success');
                } catch (error) {
                    log(`âŒ è™•ç†AIå›æ‡‰å¤±æ•—: ${error.message}`, 'error');
                }
            } else {
                log('âŒ AIåŠ©æ•™ä¸å­˜åœ¨', 'error');
            }
        }

        // å¿«é€ŸAIæ¸¬è©¦
        function quickTestAI() {
            log('ğŸš€ é–‹å§‹å¿«é€ŸAIæ¸¬è©¦...');
            testStep1();
            setTimeout(() => testStep2(), 500);
            setTimeout(() => testStep3(), 1000);
        }

        // æ¸¬è©¦å…¨åŸŸå‡½æ•¸
        function testGlobalFunctions() {
            log('ğŸ” æ¸¬è©¦å…¨åŸŸå‡½æ•¸...');
            
            const functions = ['askAI', 'globalAskAI', 'shareAIResponse', 'showAIIntro'];
            let allGood = true;
            
            functions.forEach(funcName => {
                if (typeof window[funcName] === 'function') {
                    log(`âœ… å…¨åŸŸå‡½æ•¸ ${funcName} å­˜åœ¨`, 'success');
                } else {
                    log(`âŒ å…¨åŸŸå‡½æ•¸ ${funcName} ä¸å­˜åœ¨`, 'error');
                    allGood = false;
                }
            });
            
            updateStatus('globalFuncStatus', allGood ? 'æ­£å¸¸' : 'éŒ¯èª¤', allGood ? 'success' : 'danger');
        }

        // é é¢è¼‰å…¥å®Œæˆå¾Œçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸ“„ é é¢è¼‰å…¥å®Œæˆ');
            
            // æª¢æŸ¥DOMå…ƒç´ 
            const requiredElements = ['aiResponse', 'aiShareOptions'];
            let domOk = true;
            
            requiredElements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    log(`âœ… DOMå…ƒç´  ${id} å­˜åœ¨`, 'success');
                } else {
                    log(`âŒ DOMå…ƒç´  ${id} ä¸å­˜åœ¨`, 'error');
                    domOk = false;
                }
            });
            
            updateStatus('domStatus', domOk ? 'æ­£å¸¸' : 'éŒ¯èª¤', domOk ? 'success' : 'danger');
            
            // ç­‰å¾…AIåŠ©æ•™åˆå§‹åŒ–
            setTimeout(() => {
                log('ğŸ”„ é–‹å§‹è‡ªå‹•æª¢æŸ¥...');
                testStep1();
                testGlobalFunctions();
            }, 1000);
        });
    </script>
</body>
</html> 