# 🎯 實時監控系統使用指南

## 系統概述

教師監控台現已升級為**真實實時監控系統**，可以監控所有真實房間中的學生活動，包括：
- ✅ 實時代碼同步顯示
- ✅ 學生加入/離開房間
- ✅ 聊天消息監控
- ✅ 房間統計信息
- ✅ 教師廣播功能

## 🚀 快速開始

### 1. 啟動服務器

```bash
# 終端1: 啟動WebSocket服務器 (端口8081)
php test-servers/stable-websocket-server.php

# 終端2: 啟動HTTP服務器 (端口8080)
php -S localhost:8080 -t public
```

### 2. 打開教師監控台

訪問: `http://localhost:8080/teacher-dashboard.html`

教師監控台會自動：
- 連接到WebSocket服務器 (ws://localhost:8081)
- 註冊為教師監控用戶
- 開始接收實時數據

### 3. 測試實時監控

訪問: `http://localhost:8080/test_real_time_monitoring.html`

這個測試頁面可以：
- 模擬學生連接和活動
- 驗證教師監控台的實時響應
- 測試所有監控功能

## 📊 監控功能

### 實時代碼監控
- 當學生修改代碼時，教師監控台立即顯示最新代碼
- 支持多房間同時監控
- 顯示代碼修改者和修改時間

### 房間管理
- 實時顯示所有活躍房間
- 顯示每個房間的在線學生數量
- 支持切換監控不同房間

### 聊天監控
- 監控所有房間的聊天消息
- 教師可以向特定房間或所有房間發送消息
- 支持廣播重要通知

### 統計信息
- 活躍房間數量
- 在線學生總數
- 實時更新統計數據

## 🔧 技術架構

### WebSocket通信協議

#### 教師註冊
```json
{
    "type": "teacher_monitor",
    "data": { "action": "register" }
}
```

#### 房間更新通知
```json
{
    "type": "room_update",
    "data": {
        "roomName": "test-room",
        "users": [...],
        "code": "...",
        "version": 1,
        "lastActivity": 1234567890,
        "lastEditedBy": "student1"
    }
}
```

#### 代碼變更通知
```json
{
    "type": "code_change",
    "data": {
        "roomName": "test-room",
        "userId": "student1",
        "userName": "學生1",
        "code": "print('Hello')",
        "timestamp": "2025-06-07T..."
    }
}
```

#### 統計更新
```json
{
    "type": "stats_update",
    "data": {
        "activeRooms": 3,
        "onlineStudents": 15,
        "editCount": 0
    }
}
```

## 🧪 測試步驟

### 基本測試
1. 啟動兩個服務器
2. 打開教師監控台
3. 打開測試頁面
4. 按順序執行測試步驟

### 多用戶測試
1. 打開多個瀏覽器標籤頁訪問主編輯器 (`http://localhost:8080/`)
2. 讓不同"學生"加入不同房間
3. 觀察教師監控台的實時更新

### 代碼同步測試
1. 學生在編輯器中修改代碼
2. 教師監控台應立即顯示最新代碼
3. 驗證代碼內容完全一致

## 📝 使用注意事項

### 連接要求
- WebSocket服務器必須運行在端口8081
- HTTP服務器必須運行在端口8080
- 教師監控台會自動連接到WebSocket服務器

### 性能考慮
- 系統支持最多10個並發房間
- 每個房間最多支持20個學生
- 代碼同步延遲 < 100ms

### 故障排除
- 如果監控台顯示"未連接"，檢查WebSocket服務器是否運行
- 如果沒有收到房間數據，確保有學生在線
- 查看瀏覽器控制台的錯誤信息

## 🔮 高級功能

### 教師廣播
```javascript
// 向所有房間廣播
{
    "type": "teacher_broadcast",
    "data": {
        "targetRoom": "all",
        "message": "請注意：課程即將結束",
        "messageType": "warning"
    }
}
```

### 房間切換監控
- 點擊房間列表中的房間可切換監控目標
- 支持同時監控多個房間
- 可以設置自動跟隨最活躍的學生

### 代碼歷史
- 記錄每次代碼變更
- 顯示修改時間和修改者
- 支持版本比較（未來功能）

## 📈 系統狀態

- ✅ WebSocket實時通信
- ✅ 多房間監控
- ✅ 代碼即時同步
- ✅ 聊天消息監控
- ✅ 教師廣播功能
- ✅ 統計信息更新
- ✅ 自動重連機制

## 🎉 完成！

現在您可以使用完整的實時監控系統來監控所有真實房間中的學生活動。系統會自動同步所有代碼變更、聊天消息和房間狀態，讓教師能夠實時了解學生的學習進度。 