<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI UI èª¿è©¦å·¥å…·</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h2>ğŸ” AI UI èª¿è©¦å·¥å…·</h2>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>ğŸ§ª æ¸¬è©¦AIå›æ‡‰é¡¯ç¤º</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-primary mb-3" onclick="testAIResponse()">æ¸¬è©¦AIå›æ‡‰é¡¯ç¤º</button>
                        <button class="btn btn-warning mb-3" onclick="testAIError()">æ¸¬è©¦AIéŒ¯èª¤é¡¯ç¤º</button>
                        <button class="btn btn-info mb-3" onclick="checkAIInstance()">æª¢æŸ¥AIå¯¦ä¾‹</button>
                        <button class="btn btn-success mb-3" onclick="simulateWebSocketResponse()">æ¨¡æ“¬WebSocketå›æ‡‰</button>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>ğŸ“Š èª¿è©¦ä¿¡æ¯</h5>
                    </div>
                    <div class="card-body">
                        <div id="debugInfo" style="font-family: monospace; font-size: 12px; max-height: 300px; overflow-y: auto;">
                            ç­‰å¾…èª¿è©¦ä¿¡æ¯...
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5>ğŸ¤– AIå›æ‡‰å®¹å™¨</h5>
                    </div>
                    <div class="card-body">
                        <div id="aiResponse" style="min-height: 200px; border: 1px solid #ddd; padding: 15px; border-radius: 5px;">
                            <!-- AIå›æ‡‰å°‡é¡¯ç¤ºåœ¨é€™è£¡ -->
                        </div>
                        
                        <div id="aiShareOptions" style="display: none;" class="mt-3">
                            <button class="btn btn-outline-primary btn-sm">
                                <i class="fas fa-share"></i> åˆ†äº«åˆ°èŠå¤©å®¤
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // è¼‰å…¥AIåŠ©æ•™è…³æœ¬
        const script = document.createElement('script');
        script.src = 'public/js/ai-assistant.js';
        document.head.appendChild(script);
        
        function log(message) {
            const debugInfo = document.getElementById('debugInfo');
            const timestamp = new Date().toLocaleTimeString();
            debugInfo.innerHTML += `[${timestamp}] ${message}<br>`;
            debugInfo.scrollTop = debugInfo.scrollHeight;
            console.log(message);
        }
        
        function testAIResponse() {
            log('ğŸ§ª é–‹å§‹æ¸¬è©¦AIå›æ‡‰é¡¯ç¤º...');
            
            const testResponse = {
                success: true,
                response: `é€™æ˜¯ä¸€å€‹æ¸¬è©¦AIå›æ‡‰ã€‚

**å„ªé»:**
- ä»£ç¢¼çµæ§‹æ¸…æ™°
- è®Šæ•¸å‘½åè¦ç¯„

**å»ºè­°:**
- å¯ä»¥æ·»åŠ æ›´å¤šè¨»é‡‹
- è€ƒæ…®ä½¿ç”¨å‡½æ•¸å°è£é‡è¤‡ä»£ç¢¼

**æ”¹é€²å»ºè­°:**
1. æ·»åŠ éŒ¯èª¤è™•ç†
2. å„ªåŒ–ç®—æ³•æ•ˆç‡
3. å¢åŠ ä»£ç¢¼è¨»é‡‹`
            };
            
            if (window.AIAssistant) {
                log('âœ… æ‰¾åˆ°AIAssistantå¯¦ä¾‹ï¼Œèª¿ç”¨handleWebSocketAIResponse');
                window.AIAssistant.handleWebSocketAIResponse(testResponse);
            } else {
                log('âŒ æœªæ‰¾åˆ°AIAssistantå¯¦ä¾‹');
                // æ‰‹å‹•é¡¯ç¤º
                const container = document.getElementById('aiResponse');
                if (container) {
                    container.innerHTML = `
                        <div class="alert alert-success">
                            <h6><i class="fas fa-robot"></i> æ¸¬è©¦AIå›æ‡‰</h6>
                            <div>${testResponse.response.replace(/\n/g, '<br>')}</div>
                        </div>
                    `;
                    log('âœ… æ‰‹å‹•é¡¯ç¤ºæ¸¬è©¦å›æ‡‰æˆåŠŸ');
                }
            }
        }
        
        function testAIError() {
            log('ğŸ§ª é–‹å§‹æ¸¬è©¦AIéŒ¯èª¤é¡¯ç¤º...');
            
            const testError = {
                success: false,
                error: 'é€™æ˜¯ä¸€å€‹æ¸¬è©¦éŒ¯èª¤è¨Šæ¯ï¼šAIæœå‹™æš«æ™‚ä¸å¯ç”¨'
            };
            
            if (window.AIAssistant) {
                log('âœ… æ‰¾åˆ°AIAssistantå¯¦ä¾‹ï¼Œèª¿ç”¨handleWebSocketAIResponse');
                window.AIAssistant.handleWebSocketAIResponse(testError);
            } else {
                log('âŒ æœªæ‰¾åˆ°AIAssistantå¯¦ä¾‹');
                // æ‰‹å‹•é¡¯ç¤º
                const container = document.getElementById('aiResponse');
                if (container) {
                    container.innerHTML = `
                        <div class="alert alert-danger">
                            <h6><i class="fas fa-exclamation-circle"></i> æ¸¬è©¦AIéŒ¯èª¤</h6>
                            <div>${testError.error}</div>
                        </div>
                    `;
                    log('âœ… æ‰‹å‹•é¡¯ç¤ºæ¸¬è©¦éŒ¯èª¤æˆåŠŸ');
                }
            }
        }
        
        function checkAIInstance() {
            log('ğŸ” æª¢æŸ¥AIå¯¦ä¾‹ç‹€æ…‹...');
            
            log(`window.AIAssistant å­˜åœ¨: ${!!window.AIAssistant}`);
            log(`AIAssistant é¡å‹: ${typeof window.AIAssistant}`);
            
            if (window.AIAssistant) {
                log(`handleWebSocketAIResponse æ–¹æ³•å­˜åœ¨: ${!!(window.AIAssistant.handleWebSocketAIResponse)}`);
                log(`responseContainer å­˜åœ¨: ${!!(window.AIAssistant.responseContainer)}`);
                log(`shareOptions å­˜åœ¨: ${!!(window.AIAssistant.shareOptions)}`);
                log(`isProcessing ç‹€æ…‹: ${window.AIAssistant.isProcessing}`);
                log(`isFirstPrompt ç‹€æ…‹: ${window.AIAssistant.isFirstPrompt}`);
            }
            
            // æª¢æŸ¥DOMå…ƒç´ 
            const aiResponse = document.getElementById('aiResponse');
            const aiShareOptions = document.getElementById('aiShareOptions');
            
            log(`aiResponse å…ƒç´ å­˜åœ¨: ${!!aiResponse}`);
            log(`aiShareOptions å…ƒç´ å­˜åœ¨: ${!!aiShareOptions}`);
            
            if (aiResponse) {
                log(`aiResponse ç•¶å‰å…§å®¹é•·åº¦: ${aiResponse.innerHTML.length}`);
                log(`aiResponse ç•¶å‰å…§å®¹é è¦½: ${aiResponse.innerHTML.substring(0, 100)}...`);
            }
        }
        
        function simulateWebSocketResponse() {
            log('ğŸŒ æ¨¡æ“¬WebSocket AIå›æ‡‰...');
            
            // æ¨¡æ“¬çœŸå¯¦çš„WebSocketå›æ‡‰æ ¼å¼
            const mockMessage = {
                type: 'ai_response',
                success: true,
                response: `# Python ä»£ç¢¼åˆ†æçµæœ

**ç¨‹å¼ç¢¼å“è³ªè©•ä¼°ï¼šè‰¯å¥½**

## å„ªé»ï¼š
- ä»£ç¢¼çµæ§‹æ¸…æ™°ï¼Œé‚è¼¯ç°¡æ½”
- è®Šæ•¸å‘½åç¬¦åˆPythonè¦ç¯„
- ä½¿ç”¨äº†é©ç•¶çš„å…§å»ºå‡½æ•¸

## å»ºè­°æ”¹é€²ï¼š
1. **æ·»åŠ è¨»é‡‹**ï¼šç‚ºè¤‡é›œé‚è¼¯æ·»åŠ èªªæ˜è¨»é‡‹
2. **éŒ¯èª¤è™•ç†**ï¼šè€ƒæ…®æ·»åŠ try-exceptéŒ¯èª¤è™•ç†
3. **å‡½æ•¸å°è£**ï¼šå°‡é‡è¤‡ä»£ç¢¼å°è£æˆå‡½æ•¸

## å­¸ç¿’é‡é»ï¼š
- \`print()\` å‡½æ•¸çš„æ­£ç¢ºä½¿ç”¨
- è®Šæ•¸è³¦å€¼å’Œæ“ä½œ
- åŸºæœ¬çš„ç¨‹å¼æµç¨‹æ§åˆ¶

é€™æ˜¯ä¸€å€‹å¾ˆå¥½çš„Pythonå­¸ç¿’èµ·é»ï¼ç¹¼çºŒä¿æŒé€™ç¨®ç·¨ç¨‹é¢¨æ ¼ã€‚`,
                requestId: 'test_' + Date.now(),
                timestamp: Date.now()
            };
            
            // æª¢æŸ¥WebSocketç®¡ç†å™¨æ˜¯å¦å­˜åœ¨
            if (window.wsManager && typeof window.wsManager.handleAIResponse === 'function') {
                log('âœ… æ‰¾åˆ°wsManagerï¼Œèª¿ç”¨handleAIResponse');
                window.wsManager.handleAIResponse(mockMessage);
            } else {
                log('âŒ æœªæ‰¾åˆ°wsManageræˆ–handleAIResponseæ–¹æ³•');
                
                // ç›´æ¥èª¿ç”¨AIåŠ©æ•™è™•ç†
                if (window.AIAssistant) {
                    log('âœ… ç›´æ¥èª¿ç”¨AIAssistantè™•ç†');
                    window.AIAssistant.handleWebSocketAIResponse(mockMessage);
                } else {
                    log('âŒ AIAssistantä¹Ÿä¸å­˜åœ¨ï¼Œç„¡æ³•è™•ç†');
                }
            }
        }
        
        // é é¢è¼‰å…¥å®Œæˆå¾Œçš„åˆå§‹æª¢æŸ¥
        window.addEventListener('load', function() {
            setTimeout(() => {
                log('ğŸ“‹ é é¢è¼‰å…¥å®Œæˆï¼Œé–‹å§‹åˆå§‹æª¢æŸ¥...');
                checkAIInstance();
            }, 1000);
        });
    </script>
</body>
</html> 