<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIåŠ©æ•™å‰å¾Œç«¯é€šä¿¡è¨ºæ–·</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { background: white; padding: 20px; border-radius: 8px; max-width: 800px; margin: 0 auto; }
        .result { margin: 10px 0; padding: 10px; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ AIåŠ©æ•™å‰å¾Œç«¯é€šä¿¡è¨ºæ–·</h1>
        
        <div class="test-section">
            <h3>1. å¾Œç«¯APIé€£æ¥æ¸¬è©¦</h3>
            <button onclick="testBackendAPI()">æ¸¬è©¦å¾Œç«¯API</button>
            <div id="backend-results"></div>
        </div>

        <div class="test-section">
            <h3>2. å‰ç«¯é¡¯ç¤ºæ¸¬è©¦</h3>
            <button onclick="testFrontendDisplay()">æ¸¬è©¦å‰ç«¯é¡¯ç¤º</button>
            <div id="frontend-results"></div>
        </div>

        <div class="test-section">
            <h3>3. å®Œæ•´æµç¨‹æ¸¬è©¦</h3>
            <button onclick="testCompleteFlow()">æ¸¬è©¦å®Œæ•´æµç¨‹</button>
            <div id="complete-results"></div>
        </div>
    </div>

    <script>
        function addResult(containerId, type, message, data = null) {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = `
                <strong>${new Date().toLocaleTimeString()}</strong> - ${message}
                ${data ? `<pre>${JSON.stringify(data, null, 2)}</pre>` : ''}
            `;
            container.appendChild(div);
            console.log(`[${type.toUpperCase()}] ${message}`, data);
        }

        async function testBackendAPI() {
            const results = 'backend-results';
            document.getElementById(results).innerHTML = '';
            
            const testCode = 'print("Hello World")';
            const testData = {
                action: 'analyze',
                code: testCode
            };

            try {
                addResult(results, 'info', 'ç™¼é€APIè«‹æ±‚...', testData);
                
                const response = await fetch('/backend/api/ai.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(testData)
                });

                addResult(results, 'info', `HTTPç‹€æ…‹: ${response.status} ${response.statusText}`);

                if (!response.ok) {
                    const errorText = await response.text();
                    addResult(results, 'error', 'HTTPéŒ¯èª¤', { status: response.status, error: errorText });
                    return;
                }

                const responseData = await response.json();
                addResult(results, 'success', 'APIå›æ‡‰æˆåŠŸ', responseData);

            } catch (error) {
                addResult(results, 'error', 'ç¶²è·¯éŒ¯èª¤', { message: error.message });
            }
        }

        function testFrontendDisplay() {
            const results = 'frontend-results';
            document.getElementById(results).innerHTML = '';
            
            // æ¨¡æ“¬AIå›æ‡‰æ•¸æ“š
            const mockAIResponse = {
                success: true,
                data: {
                    analysis: "é€™æ˜¯ä¸€å€‹ç°¡å–®çš„Pythonç¨‹å¼ï¼Œä½¿ç”¨print()å‡½æ•¸è¼¸å‡ºã€ŒHello Worldã€åˆ°æ§åˆ¶å°ã€‚é€™æ˜¯ç¨‹å¼è¨­è¨ˆå­¸ç¿’çš„ç¶“å…¸å…¥é–€ç¯„ä¾‹ã€‚",
                    token_usage: 50,
                    execution_time: 1.2
                },
                message: "AIåˆ†æå®Œæˆ"
            };

            addResult(results, 'info', 'æ¸¬è©¦å‰ç«¯é¡¯ç¤ºåŠŸèƒ½');
            
            // å‰µå»ºæ¸¬è©¦é¡¯ç¤ºå€åŸŸ
            const testDiv = document.createElement('div');
            testDiv.id = 'test-ai-response';
            testDiv.style.cssText = 'border: 2px solid #007bff; padding: 15px; margin: 10px 0; border-radius: 8px;';
            
            // æ¨¡æ“¬å‰ç«¯é¡¯ç¤ºé‚è¼¯
            testDiv.innerHTML = `
                <div class="ai-response-card" style="background-color: #fff; border-radius: 5px; padding: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                    <div class="ai-response-header d-flex align-items-center mb-2" style="border-bottom: 1px solid #eee; padding-bottom: 10px;">
                        <i class="fas fa-robot text-primary me-2" style="font-size: 1.2em;">ğŸ¤–</i>
                        <span class="fw-bold" style="font-size: 1.1em;">AIåŠ©æ•™å»ºè­°</span>
                    </div>
                    <div class="ai-response-content" style="font-size: 0.95em; line-height: 1.6;">
                        <h6><i class="fas fa-brain">ğŸ§ </i> AIåŠ©æ•™åˆ†æçµæœ</h6>
                        <div class="mb-3">${mockAIResponse.data.analysis}</div>
                    </div>
                </div>
            `;
            
            document.getElementById(results).appendChild(testDiv);
            addResult(results, 'success', 'å‰ç«¯é¡¯ç¤ºæ¸¬è©¦å®Œæˆ', mockAIResponse);
        }

        async function testCompleteFlow() {
            const results = 'complete-results';
            document.getElementById(results).innerHTML = '';
            
            addResult(results, 'info', 'é–‹å§‹å®Œæ•´æµç¨‹æ¸¬è©¦...');
            
            try {
                // æ­¥é©Ÿ1ï¼šç™¼é€APIè«‹æ±‚
                const testData = {
                    action: 'analyze',
                    code: 'print("Hello from complete test")'
                };
                
                addResult(results, 'info', 'æ­¥é©Ÿ1ï¼šç™¼é€APIè«‹æ±‚');
                const response = await fetch('/backend/api/ai.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(testData)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const apiResult = await response.json();
                addResult(results, 'success', 'æ­¥é©Ÿ1å®Œæˆï¼šAPIå›æ‡‰æˆåŠŸ');
                
                // æ­¥é©Ÿ2ï¼šæ¨¡æ“¬å‰ç«¯è™•ç†
                addResult(results, 'info', 'æ­¥é©Ÿ2ï¼šæ¨¡æ“¬å‰ç«¯è™•ç†');
                
                if (apiResult.success && apiResult.data && apiResult.data.analysis) {
                    // å‰µå»ºå®Œæ•´æ¸¬è©¦é¡¯ç¤º
                    const completeTestDiv = document.createElement('div');
                    completeTestDiv.style.cssText = 'border: 2px solid #28a745; padding: 15px; margin: 10px 0; border-radius: 8px; background: #f8fff9;';
                    
                    completeTestDiv.innerHTML = `
                        <h6>ğŸ‰ å®Œæ•´æµç¨‹æ¸¬è©¦æˆåŠŸï¼</h6>
                        <div><strong>APIå›æ‡‰ï¼š</strong></div>
                        <div style="background: #e7f7e7; padding: 10px; margin: 5px 0; border-radius: 4px;">
                            ${apiResult.data.analysis}
                        </div>
                        <div><strong>åŸ·è¡Œæ™‚é–“ï¼š</strong> ${apiResult.data.execution_time || 'N/A'}ç§’</div>
                        <div><strong>Tokenä½¿ç”¨ï¼š</strong> ${apiResult.data.token_usage || 'N/A'}</div>
                    `;
                    
                    document.getElementById(results).appendChild(completeTestDiv);
                    addResult(results, 'success', 'æ­¥é©Ÿ2å®Œæˆï¼šå‰ç«¯é¡¯ç¤ºæˆåŠŸ');
                    addResult(results, 'success', 'ğŸ‰ å®Œæ•´æµç¨‹æ¸¬è©¦é€šéï¼AIåŠ©æ•™åŠŸèƒ½æ­£å¸¸');
                    
                } else {
                    addResult(results, 'error', 'æ­¥é©Ÿ2å¤±æ•—ï¼šAPIå›æ‡‰æ ¼å¼ç•°å¸¸', apiResult);
                }
                
            } catch (error) {
                addResult(results, 'error', 'å®Œæ•´æµç¨‹æ¸¬è©¦å¤±æ•—', { message: error.message });
            }
        }
    </script>
</body>
</html> 