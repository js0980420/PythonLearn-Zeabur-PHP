# Zeabur éƒ¨ç½²é…ç½® - å–®æœå‹™æ•´åˆæ¶æ§‹ (ä¿®å¾©ç‰ˆ)
name: python-learn

services:
  # æ•´åˆæœå‹™ (HTTP + WebSocket åœ¨åŒä¸€ç«¯å£)
  web:
    build:
      dockerfile: Dockerfile.simple
    
    # ç’°å¢ƒè®Šæ•¸é…ç½®
    env:
      # æ‡‰ç”¨é…ç½®
      APP_ENV: "production"
      DEBUG_MODE: "false"
      PORT: "8080"
      
      # AI é…ç½® (å¾ Zeabur ç’°å¢ƒè®Šæ•¸)
      OPENAI_API_KEY: ${OPENAI_API_KEY}
      OPENAI_MODEL: ${OPENAI_MODEL}
      OPENAI_MAX_TOKENS: ${OPENAI_MAX_TOKENS}
      
      # æ•¸æ“šåº«é…ç½® (å¾ Zeabur ç’°å¢ƒè®Šæ•¸)
      MYSQL_HOST: ${MYSQL_HOST}
      MYSQL_USER: ${MYSQL_USER}
      MYSQL_PASSWORD: ${MYSQL_PASSWORD}
      MYSQL_DATABASE: ${MYSQL_DATABASE}
      MYSQL_PORT: ${MYSQL_PORT}
    
    # æš´éœ²ç«¯å£ (åªæœ‰ä¸€å€‹ç«¯å£)
    ports:
      - 8080
    
    # å¥åº·æª¢æŸ¥
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

# ğŸ“Š ç›£æ§é…ç½®
monitoring:
  enabled: true
  metrics:
    - name: http_requests_total
      type: counter
      help: "Total HTTP requests"
    
    - name: websocket_connections
      type: gauge
      help: "Active WebSocket connections"
    
    - name: ai_requests_total
      type: counter
      help: "Total AI assistant requests"

# ğŸ” å¯†é‘°ç®¡ç†
secrets:
  openai-api-key:
    external: true
    name: OPENAI_API_KEY

# å·é…ç½®
volumes:
  mysql_data:
    driver: local

# å¥åº·æª¢æŸ¥é…ç½®
healthcheck:
  web:
    path: /health.php
    interval: 30s
    timeout: 10s
    
  caddy:
    port: 80
    interval: 30s
    timeout: 10s

# ç’°å¢ƒè®Šæ•¸é…ç½®
env:
  # OpenAI API å¯†é‘°ï¼ˆéœ€è¦åœ¨ Zeabur æ§åˆ¶å°è¨­ç½®ï¼‰
  OPENAI_API_KEY:
    type: secret
    
  # åŸŸåï¼ˆZeabur è‡ªå‹•è¨­ç½®ï¼‰
  ZEABUR_DOMAIN:
    type: auto 