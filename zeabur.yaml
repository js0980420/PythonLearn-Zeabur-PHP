# ğŸš€ Zeabur é›²ç«¯éƒ¨ç½²é…ç½® - ç´” HTTP è¼ªè©¢ç‰ˆ
# Pythonå¤šäººå”ä½œæ•™å­¸å¹³å°å°ˆç”¨é…ç½®

name: pythonlearn-collaboration

# âš™ï¸ å…¨åŸŸè¨­å®š
config:
  # ğŸ”§ PHP é‹è¡Œæ™‚é…ç½®
  runtime: php
  php_version: "8.2"

  # ğŸŒ ç¶²è·¯é…ç½®
  network:
    # HTTP æœå‹™å™¨ç«¯å£
    http_port: 8080

  # ğŸ“Š è³‡æºé…ç½®
  resources:
    cpu: "1000m" # 1 CPU core
    memory: "512Mi" # 512MB RAM

  # ğŸ¥ å¥åº·æª¢æŸ¥é…ç½®
  health_check:
    path: "/health.php"
    port: 8080
    timeout: 30s

# ğŸ“¦ å»ºæ§‹é…ç½®
build:
  # å»ºæ§‹æŒ‡ä»¤
  commands:
    - "composer install --no-dev --optimize-autoloader"

  # å¿½ç•¥æª”æ¡ˆ
  ignore:
    - "*.md"
    - ".cursor/"
    - ".vscode/"

# ğŸš€ éƒ¨ç½²é…ç½®
deploy:
  # å•Ÿå‹•æŒ‡ä»¤ - ç´” HTTP æœå‹™å™¨
  start_command: "php -S 0.0.0.0:8080 -t public"

  # ç«¯å£é…ç½® - åƒ… HTTP
  ports:
    - port: 8080
      protocol: "http"
      public: true

  # ğŸŒ ç’°å¢ƒè®Šæ•¸
  envs:
    # å¹³å°è­˜åˆ¥
    PLATFORM: "zeabur"
    NODE_ENV: "production"
    DEPLOYMENT_MODE: "cloud"

    # æœå‹™å™¨é…ç½®
    HTTP_PORT: "8080"
    CONNECTION_MODE: "http_polling"

    # æ‡‰ç”¨é…ç½®
    MAX_CONCURRENT_USERS: "100"
    MAX_ROOMS: "50"
    MAX_USERS_PER_ROOM: "8"

    # PHP é…ç½®
    PHP_MEMORY_LIMIT: "256M"
    PHP_MAX_EXECUTION_TIME: "300"
    PHP_POST_MAX_SIZE: "10M"
    PHP_UPLOAD_MAX_FILESIZE: "10M"

    # Session é…ç½®
    SESSION_LIFETIME: "86400"

    # æ—¥èªŒé…ç½®
    LOG_LEVEL: "info"
    ERROR_REPORTING: "E_ALL & ~E_NOTICE"

# ğŸ”„ æœå‹™é…ç½®
services:
  # ä¸»è¦ Web æœå‹™
  web:
    type: "php"
    php_version: "8.2"

    # ğŸ—ï¸ å»ºæ§‹è¨­å®š
    build:
      dockerfile: false
      buildCommand: |
        echo "ğŸ“¦ å®‰è£ Composer ä¾è³´..."
        composer install --no-dev --optimize-autoloader
        echo "âœ… å»ºæ§‹å®Œæˆ"

    # ğŸš€ å•Ÿå‹•å‘½ä»¤
    startCommand: "php -S 0.0.0.0:$PORT -t public"

    # ğŸŒ ç’°å¢ƒè®Šæ•¸
    env:
      NODE_ENV: production
      CONNECTION_MODE: http_polling
      PLATFORM: zeabur
      DEPLOYMENT_MODE: cloud
      # AI é…ç½®
      OPENAI_API_KEY: ${OPENAI_API_KEY}
      OPENAI_MODEL: ${OPENAI_MODEL}
      # æ•¸æ“šåº«é…ç½®
      MYSQL_HOST: ${MYSQL_HOST}
      MYSQL_USER: ${MYSQL_USER}
      MYSQL_PASSWORD: ${MYSQL_PASSWORD}
      MYSQL_DATABASE: pythonlearn
      MYSQL_PORT: ${MYSQL_PORT}

    # ğŸ”Œ ç«¯å£é…ç½® - å–®ç«¯å£
    ports:
      - 8080

    # ğŸ¥ å¥åº·æª¢æŸ¥
    healthcheck:
      path: /health.php
      interval: 30s
      timeout: 10s
      retries: 3

    # ğŸ“Š è³‡æºé…ç½®
    resources:
      cpu: 1000m
      memory: 512Mi

# ğŸ“ é¡å¤–é…ç½®
extras:
  # ğŸ”§ è‡ªå‹•é‡å•Ÿé…ç½®
  auto_restart: true

  # ğŸ“Š ç›£æ§é…ç½®
  monitoring:
    enabled: true

  # ğŸ”’ å®‰å…¨é…ç½®
  security:
    force_https: true
