<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIåŠ©æ•™ç·¨è¼¯å™¨äº¤äº’æ¸¬è©¦</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/monokai.min.css">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .editor-container { height: 300px; border: 1px solid #ccc; }
        .result { margin: 10px 0; padding: 10px; background: #f5f5f5; border-radius: 3px; white-space: pre-wrap; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        button { margin: 5px; padding: 8px 15px; cursor: pointer; }
        .ai-response { margin: 10px 0; padding: 15px; background: #e7f3ff; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ AIåŠ©æ•™ç·¨è¼¯å™¨äº¤äº’æ¸¬è©¦</h1>
        
        <div class="test-section">
            <h2>ğŸ“ ä»£ç¢¼ç·¨è¼¯å™¨</h2>
            <div id="editor-container" class="editor-container"></div>
            <button onclick="insertSampleCode()">æ’å…¥ç¯„ä¾‹ä»£ç¢¼</button>
            <button onclick="clearEditor()">æ¸…ç©ºç·¨è¼¯å™¨</button>
        </div>
        
        <div class="test-section">
            <h2>ğŸ” ç·¨è¼¯å™¨ç‹€æ…‹æª¢æŸ¥</h2>
            <button onclick="checkEditorStatus()">æª¢æŸ¥ç·¨è¼¯å™¨ç‹€æ…‹</button>
            <button onclick="getEditorCode()">ç²å–ç·¨è¼¯å™¨ä»£ç¢¼</button>
            <div id="editor-status" class="result"></div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ¤– AIåŠ©æ•™æ¸¬è©¦</h2>
            <button onclick="testAIAssistant()">æ¸¬è©¦AIåŠ©æ•™åˆå§‹åŒ–</button>
            <button onclick="testAIRequest()">æ¸¬è©¦AIè«‹æ±‚</button>
            <button onclick="simulateAIAnalysis()">æ¨¡æ“¬AIåˆ†æ</button>
            <div id="ai-status" class="result"></div>
            <div id="ai-response" class="ai-response" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h2>ğŸŒ WebSocketæ¸¬è©¦</h2>
            <button onclick="testWebSocketConnection()">æ¸¬è©¦WebSocketé€£æ¥</button>
            <button onclick="sendTestMessage()">ç™¼é€æ¸¬è©¦æ¶ˆæ¯</button>
            <div id="websocket-status" class="result"></div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“Š å®Œæ•´æµç¨‹æ¸¬è©¦</h2>
            <button onclick="runFullTest()">é‹è¡Œå®Œæ•´æ¸¬è©¦</button>
            <div id="full-test-result" class="result"></div>
        </div>
    </div>

    <!-- è¼‰å…¥å¿…è¦çš„è…³æœ¬ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.min.js"></script>
    
    <script>
        // å…¨åŸŸè®Šæ•¸
        let editor = null;
        let wsManager = null;
        let aiAssistant = null;
        
        // åˆå§‹åŒ–ç·¨è¼¯å™¨
        function initializeEditor() {
            const container = document.getElementById('editor-container');
            editor = CodeMirror(container, {
                mode: 'python',
                theme: 'monokai',
                lineNumbers: true,
                autoCloseBrackets: true,
                matchBrackets: true,
                indentUnit: 4,
                value: '# æ­¡è¿ä½¿ç”¨Pythonå”ä½œå¹³å°\\nprint(\"Hello, World!\")'
            });
            
            // ç¶å®šåˆ°å…¨åŸŸè®Šæ•¸ (æ¨¡æ“¬ä¸»æ‡‰ç”¨)
            window.Editor = {
                editor: editor,
                getCode: function() {
                    return editor.getValue();
                },
                setCode: function(code) {
                    editor.setValue(code);
                }
            };
            
            console.log('âœ… ç·¨è¼¯å™¨åˆå§‹åŒ–å®Œæˆ');
        }
        
        // æ’å…¥ç¯„ä¾‹ä»£ç¢¼
        function insertSampleCode() {
            const sampleCode = `# Python ç¯„ä¾‹ä»£ç¢¼
def fibonacci(n):
    if n <= 1:
        return n
    else:
        return fibonacci(n-1) + fibonacci(n-2)

# è¨ˆç®—å‰10å€‹è²»æ³¢é‚£å¥‘æ•¸åˆ—
for i in range(10):
    print(f"F({i}) = {fibonacci(i)}")
    
# åˆ—è¡¨æ¨å°å¼ç¯„ä¾‹
squares = [x**2 for x in range(1, 11)]
print("å¹³æ–¹æ•¸:", squares)`;
            
            if (editor) {
                editor.setValue(sampleCode);
                updateStatus('editor-status', 'âœ… å·²æ’å…¥ç¯„ä¾‹ä»£ç¢¼', 'success');
            } else {
                updateStatus('editor-status', 'âŒ ç·¨è¼¯å™¨æœªåˆå§‹åŒ–', 'error');
            }
        }
        
        // æ¸…ç©ºç·¨è¼¯å™¨
        function clearEditor() {
            if (editor) {
                editor.setValue('');
                updateStatus('editor-status', 'âœ… ç·¨è¼¯å™¨å·²æ¸…ç©º', 'success');
            }
        }
        
        // æª¢æŸ¥ç·¨è¼¯å™¨ç‹€æ…‹
        function checkEditorStatus() {
            let status = '';
            
            if (window.Editor) {
                status += 'âœ… window.Editor å­˜åœ¨\\n';
                
                if (window.Editor.editor) {
                    status += 'âœ… CodeMirror å¯¦ä¾‹å­˜åœ¨\\n';
                } else {
                    status += 'âŒ CodeMirror å¯¦ä¾‹ä¸å­˜åœ¨\\n';
                }
                
                if (typeof window.Editor.getCode === 'function') {
                    status += 'âœ… getCode æ–¹æ³•å­˜åœ¨\\n';
                } else {
                    status += 'âŒ getCode æ–¹æ³•ä¸å­˜åœ¨\\n';
                }
            } else {
                status += 'âŒ window.Editor ä¸å­˜åœ¨\\n';
            }
            
            updateStatus('editor-status', status, 'success');
        }
        
        // ç²å–ç·¨è¼¯å™¨ä»£ç¢¼
        function getEditorCode() {
            try {
                if (window.Editor && typeof window.Editor.getCode === 'function') {
                    const code = window.Editor.getCode();
                    const status = \`âœ… æˆåŠŸç²å–ä»£ç¢¼\\né•·åº¦: \${code.length} å­—ç¬¦\\nå…§å®¹é è¦½: \${code.substring(0, 100)}\${code.length > 100 ? '...' : ''}\`;
                    updateStatus('editor-status', status, 'success');
                } else {
                    updateStatus('editor-status', 'âŒ ç„¡æ³•ç²å–ç·¨è¼¯å™¨ä»£ç¢¼', 'error');
                }
            } catch (error) {
                updateStatus('editor-status', \`âŒ ç²å–ä»£ç¢¼æ™‚ç™¼ç”ŸéŒ¯èª¤: \${error.message}\`, 'error');
            }
        }
        
        // æ¸¬è©¦AIåŠ©æ•™åˆå§‹åŒ–
        function testAIAssistant() {
            try {
                // æ¨¡æ“¬AIåŠ©æ•™é¡
                class MockAIAssistant {
                    constructor() {
                        this.isInitialized = false;
                    }
                    
                    initialize() {
                        this.isInitialized = true;
                        console.log('ğŸ¤– AIåŠ©æ•™åˆå§‹åŒ–å®Œæˆ');
                    }
                    
                    async requestAnalysis(code, type = 'explain') {
                        console.log('ğŸ”„ ç™¼é€AIè«‹æ±‚...', { code: code.substring(0, 50), type });
                        
                        // æ¨¡æ“¬APIè«‹æ±‚
                        return new Promise((resolve, reject) => {
                            setTimeout(() => {
                                if (code && code.trim()) {
                                    resolve({
                                        success: true,
                                        analysis: \`é€™æ˜¯å°ä»£ç¢¼çš„\${type}åˆ†æï¼š\\n\\nä»£ç¢¼çœ‹èµ·ä¾†ä¸éŒ¯ï¼åŒ…å«äº†\${code.split('\\n').length}è¡Œä»£ç¢¼ã€‚\`,
                                        suggestions: ['å»ºè­°æ·»åŠ æ›´å¤šè¨»é‡‹', 'è€ƒæ…®ä½¿ç”¨æ›´æè¿°æ€§çš„è®Šæ•¸åç¨±']
                                    });
                                } else {
                                    reject(new Error('ä»£ç¢¼ç‚ºç©º'));
                                }
                            }, 1000);
                        });
                    }
                }
                
                aiAssistant = new MockAIAssistant();
                aiAssistant.initialize();
                window.AIAssistant = aiAssistant;
                
                updateStatus('ai-status', 'âœ… AIåŠ©æ•™åˆå§‹åŒ–æˆåŠŸ', 'success');
            } catch (error) {
                updateStatus('ai-status', \`âŒ AIåŠ©æ•™åˆå§‹åŒ–å¤±æ•—: \${error.message}\`, 'error');
            }
        }
        
        // æ¸¬è©¦AIè«‹æ±‚
        async function testAIRequest() {
            try {
                if (!aiAssistant) {
                    updateStatus('ai-status', 'âš ï¸ è«‹å…ˆåˆå§‹åŒ–AIåŠ©æ•™', 'warning');
                    return;
                }
                
                const code = window.Editor ? window.Editor.getCode() : '';
                if (!code || code.trim() === '') {
                    updateStatus('ai-status', 'âš ï¸ ç·¨è¼¯å™¨ä»£ç¢¼ç‚ºç©º', 'warning');
                    return;
                }
                
                updateStatus('ai-status', 'ğŸ”„ æ­£åœ¨è«‹æ±‚AIåˆ†æ...', 'warning');
                
                const result = await aiAssistant.requestAnalysis(code, 'explain');
                
                if (result.success) {
                    updateStatus('ai-status', 'âœ… AIåˆ†ææˆåŠŸ', 'success');
                    showAIResponse(result.analysis);
                } else {
                    updateStatus('ai-status', 'âŒ AIåˆ†æå¤±æ•—', 'error');
                }
            } catch (error) {
                updateStatus('ai-status', \`âŒ AIè«‹æ±‚éŒ¯èª¤: \${error.message}\`, 'error');
            }
        }
        
        // æ¨¡æ“¬AIåˆ†æ
        function simulateAIAnalysis() {
            const mockResponse = {
                analysis: \`# ä»£ç¢¼åˆ†æçµæœ

## ä»£ç¢¼æ¦‚è¿°
æ‚¨çš„Pythonä»£ç¢¼çµæ§‹è‰¯å¥½ï¼ŒåŒ…å«äº†ä»¥ä¸‹ç‰¹é»ï¼š

1. **å‡½æ•¸å®šç¾©**: ä½¿ç”¨äº†éæ­¸å‡½æ•¸ä¾†è¨ˆç®—è²»æ³¢é‚£å¥‘æ•¸åˆ—
2. **è¿´åœˆçµæ§‹**: ä½¿ç”¨forè¿´åœˆä¾†è¼¸å‡ºçµæœ
3. **åˆ—è¡¨æ¨å°å¼**: å±•ç¤ºäº†Pythonçš„é«˜ç´šç‰¹æ€§

## å»ºè­°æ”¹é€²
- è€ƒæ…®ä½¿ç”¨å‹•æ…‹è¦åŠƒä¾†å„ªåŒ–è²»æ³¢é‚£å¥‘å‡½æ•¸çš„æ€§èƒ½
- æ·»åŠ è¼¸å…¥é©—è­‰ä¾†è™•ç†é‚Šç•Œæƒ…æ³
- ä½¿ç”¨æ›´æè¿°æ€§çš„è®Šæ•¸åç¨±

## ç¨‹å¼ç¢¼å“è³ªè©•åˆ†
â­â­â­â­â˜† (4/5)\`,
                suggestions: [
                    'ä½¿ç”¨å‹•æ…‹è¦åŠƒå„ªåŒ–éæ­¸',
                    'æ·»åŠ éŒ¯èª¤è™•ç†',
                    'æ”¹å–„è®Šæ•¸å‘½å'
                ]
            };
            
            showAIResponse(mockResponse.analysis);
            updateStatus('ai-status', 'âœ… æ¨¡æ“¬AIåˆ†æå®Œæˆ', 'success');
        }
        
        // é¡¯ç¤ºAIå›æ‡‰
        function showAIResponse(response) {
            const container = document.getElementById('ai-response');
            container.innerHTML = \`<h3>ğŸ¤– AIåŠ©æ•™åˆ†æçµæœ</h3><pre>\${response}</pre>\`;
            container.style.display = 'block';
        }
        
        // æ¸¬è©¦WebSocketé€£æ¥
        function testWebSocketConnection() {
            try {
                // å˜—è©¦é€£æ¥åˆ°WebSocketæœå‹™å™¨
                const ws = new WebSocket('ws://localhost:8081');
                
                ws.onopen = function() {
                    updateStatus('websocket-status', 'âœ… WebSocketé€£æ¥æˆåŠŸ', 'success');
                    ws.close();
                };
                
                ws.onerror = function(error) {
                    updateStatus('websocket-status', 'âŒ WebSocketé€£æ¥å¤±æ•—', 'error');
                };
                
                ws.onclose = function() {
                    console.log('WebSocketé€£æ¥å·²é—œé–‰');
                };
                
                // è¨­ç½®è¶…æ™‚
                setTimeout(() => {
                    if (ws.readyState === WebSocket.CONNECTING) {
                        ws.close();
                        updateStatus('websocket-status', 'âš ï¸ WebSocketé€£æ¥è¶…æ™‚', 'warning');
                    }
                }, 5000);
                
            } catch (error) {
                updateStatus('websocket-status', \`âŒ WebSocketæ¸¬è©¦éŒ¯èª¤: \${error.message}\`, 'error');
            }
        }
        
        // ç™¼é€æ¸¬è©¦æ¶ˆæ¯
        function sendTestMessage() {
            updateStatus('websocket-status', 'ğŸ”„ æ¸¬è©¦æ¶ˆæ¯ç™¼é€åŠŸèƒ½...', 'warning');
            // é€™è£¡å¯ä»¥æ·»åŠ å¯¦éš›çš„æ¶ˆæ¯ç™¼é€é‚è¼¯
            setTimeout(() => {
                updateStatus('websocket-status', 'âœ… æ¸¬è©¦æ¶ˆæ¯ç™¼é€å®Œæˆ', 'success');
            }, 1000);
        }
        
        // é‹è¡Œå®Œæ•´æ¸¬è©¦
        async function runFullTest() {
            const results = [];
            
            updateStatus('full-test-result', 'ğŸ”„ é–‹å§‹å®Œæ•´æ¸¬è©¦...', 'warning');
            
            // 1. æª¢æŸ¥ç·¨è¼¯å™¨
            try {
                if (window.Editor && window.Editor.getCode) {
                    const code = window.Editor.getCode();
                    results.push(\`âœ… ç·¨è¼¯å™¨: æ­£å¸¸ (ä»£ç¢¼é•·åº¦: \${code.length})\`);
                } else {
                    results.push('âŒ ç·¨è¼¯å™¨: ç•°å¸¸');
                }
            } catch (e) {
                results.push(\`âŒ ç·¨è¼¯å™¨: éŒ¯èª¤ - \${e.message}\`);
            }
            
            // 2. æª¢æŸ¥AIåŠ©æ•™
            try {
                if (aiAssistant && aiAssistant.isInitialized) {
                    results.push('âœ… AIåŠ©æ•™: å·²åˆå§‹åŒ–');
                } else {
                    results.push('âš ï¸ AIåŠ©æ•™: æœªåˆå§‹åŒ–');
                }
            } catch (e) {
                results.push(\`âŒ AIåŠ©æ•™: éŒ¯èª¤ - \${e.message}\`);
            }
            
            // 3. æ¸¬è©¦å®Œæ•´æµç¨‹
            try {
                if (window.Editor && aiAssistant) {
                    const code = window.Editor.getCode();
                    if (code && code.trim()) {
                        const result = await aiAssistant.requestAnalysis(code);
                        if (result.success) {
                            results.push('âœ… å®Œæ•´æµç¨‹: æˆåŠŸ');
                        } else {
                            results.push('âŒ å®Œæ•´æµç¨‹: AIåˆ†æå¤±æ•—');
                        }
                    } else {
                        results.push('âš ï¸ å®Œæ•´æµç¨‹: ä»£ç¢¼ç‚ºç©º');
                    }
                } else {
                    results.push('âŒ å®Œæ•´æµç¨‹: çµ„ä»¶æœªå°±ç·’');
                }
            } catch (e) {
                results.push(\`âŒ å®Œæ•´æµç¨‹: éŒ¯èª¤ - \${e.message}\`);
            }
            
            updateStatus('full-test-result', results.join('\\n'), 'success');
        }
        
        // æ›´æ–°ç‹€æ…‹é¡¯ç¤º
        function updateStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = \`result \${type}\`;
        }
        
        // é é¢è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ é é¢è¼‰å…¥å®Œæˆï¼Œé–‹å§‹åˆå§‹åŒ–...');
            initializeEditor();
            
            // è‡ªå‹•é‹è¡ŒåŸºæœ¬æª¢æŸ¥
            setTimeout(() => {
                checkEditorStatus();
            }, 500);
        });
    </script>
</body>
</html> 